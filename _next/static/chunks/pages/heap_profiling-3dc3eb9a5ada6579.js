(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3],{84808:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/heap_profiling",function(){return n(73101)}])},79086:function(e,t,n){"use strict";n.d(t,{OL:function(){return getClusterInfoComputeNode},X8:function(){return getClusterMetrics},xv:function(){return getClusterInfoFrontend}});var r=n(2789),a=n(34269);async function getClusterMetrics(){let e=await a.Z.get("/api/metrics/cluster");return e}async function getClusterInfoFrontend(){let e=(await a.Z.get("/api/clusters/1")).map(r.cX.fromJSON);return e}async function getClusterInfoComputeNode(){let e=(await a.Z.get("/api/clusters/2")).map(r.cX.fromJSON);return e}},30707:function(e,t,n){"use strict";n.d(t,{Z:function(){return useFetch}});var r=n(66479),a=n(67294);function useFetch(e){let[t,n]=(0,a.useState)(),l=(0,r.pm)();return(0,a.useEffect)(()=>{let fetchData=async()=>{try{let t=await e();n(t)}catch(e){l({title:"Error Occurred",description:e.toString(),status:"error",duration:5e3,isClosable:!0}),console.error(e)}};fetchData()},[l,e]),{response:t}}},73101:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return HeapProfiling}});var r=n(85893),a=n(40639),l=n(83234),o=n(57026),i=n(47741),c=n(19604),s=n(45772),u=n.n(s),d=n(42474),f=n(9008),p=n.n(f),m=n(1864),h=n.n(m),g=n(67294),T=n(13817),j=n(44527),v=n(63528),y=n(34269),x=n(79086),b=n(30707);function HeapProfiling(){let{response:e}=(0,b.Z)(x.OL),[t,n]=(0,g.useState)(),[s,f]=(0,g.useState)(""),[m,w]=(0,g.useState)(),[C,O]=(0,g.useState)(),[S,P]=(0,g.useState)("Auto"),[N,A]=(0,g.useState)();async function getProfileList(e,t){if(e&&t&&e.length>0)try{let e=v.R_.fromJSON(await y.Z.get("/api/monitor/list_heap_profile/".concat(t)));w(e)}catch(e){console.error(e),f("Getting Profiling File List\n$Error: ".concat(e.message,"]"))}}async function dumpProfile(){y.Z.get("/api/monitor/dump_heap_profile/".concat(t)),getProfileList(e,t)}async function analyzeHeapFile(){let e;if(void 0===C||void 0===N){console.log("selectedProfileList: ".concat(C,", analyzeTargetFileName: ").concat(N));return}let n=h().join(C.dir,N);f("Analyzing ".concat(N," from Compute Node ").concat(t));let r="Collapsed Profiling of Compute Node ".concat(t," for ").concat(N);try{let a=u()(n),l=await fetch("/api/monitor/analyze/".concat(t,"/").concat(a)).then(async e=>({filename:e.headers.get("content-disposition"),blob:await e.blob()})),o=window.URL.createObjectURL(l.blob),i=document.createElement("a");i.href=o,i.download=l.filename||(0,d.randomUUID)(),i.click(),e="".concat(r,"\n\nDownloaded!")}catch(t){e="".concat(r,"\n\nError: ").concat(t.message)}f(e)}(0,g.useEffect)(()=>{e&&!t&&e.length>0&&n(e[0].id)},[e,t]),(0,g.useEffect)(()=>{getProfileList(e,t)},[e,t]),(0,g.useEffect)(()=>{m&&("Auto"===S?O({dir:m.dir,name:m.nameAuto}):"Manually"===S?O({dir:m.dir,name:m.nameManually}):console.error("Bad profileType ".concat(S)))},[S,m]),(0,g.useEffect)(()=>{C&&C.name.length>0&&A(C.name[0])},[C]);let k=(0,r.jsxs)(a.kC,{p:3,height:"calc(50vh - 20px)",flexDirection:"column",children:[(0,r.jsx)(j.Z,{children:"Heap Profiling"}),(0,r.jsxs)(a.kC,{flexDirection:"row",height:"full",width:"full",children:[(0,r.jsxs)(a.gC,{mr:3,spacing:3,alignItems:"flex-start",width:200,height:"full",children:[(0,r.jsxs)(l.NI,{children:[(0,r.jsx)(l.lX,{textColor:"blue.500",children:"Dump Heap Profile"}),(0,r.jsxs)(a.gC,{children:[(0,r.jsx)(l.lX,{children:"Compute Nodes"}),(0,r.jsx)(o.Ph,{onChange:e=>n(parseInt(e.target.value)),children:e&&e.map(e=>{var t,n;return(0,r.jsxs)("option",{value:e.id,children:["(",e.id,") ",null===(t=e.host)||void 0===t?void 0:t.host,":",null===(n=e.host)||void 0===n?void 0:n.port]},e.id)})}),(0,r.jsx)(i.zx,{onClick:e=>dumpProfile(),width:"full",children:"Dump"})]})]}),(0,r.jsxs)(l.NI,{children:[(0,r.jsx)(l.lX,{textColor:"blue.500",children:"Analyze Heap Profile"}),(0,r.jsxs)(a.gC,{children:[(0,r.jsx)(l.lX,{children:"Dumped By"}),(0,r.jsx)(o.Ph,{onChange:e=>P(e.target.value),children:["Auto","Manually"].map(e=>(0,r.jsx)("option",{value:e,children:e},e))}),(0,r.jsx)(l.lX,{children:"Dumped Files"}),(0,r.jsx)(o.Ph,{onChange:e=>A(e.target.value),children:C&&C.name.map(e=>(0,r.jsx)("option",{value:e,children:e},e))}),(0,r.jsx)(i.zx,{onClick:e=>analyzeHeapFile(),width:"full",children:"Analyze"})]})]})]}),(0,r.jsx)(a.xu,{flex:1,height:"full",ml:3,overflowX:"scroll",overflowY:"scroll",children:void 0===s?(0,r.jsx)(T.Z,{}):(0,r.jsx)(c.ZP,{language:"sql",options:{fontSize:13,readOnly:!0,renderWhitespace:"boundary",wordWrap:"on"},defaultValue:'Select a compute node and target profiling result file and click "Analyze"...',value:s})})]})]});return(0,r.jsxs)(g.Fragment,{children:[(0,r.jsx)(p(),{children:(0,r.jsx)("title",{children:"Heap Profiling"})}),k]})}},63528:function(e,t,n){"use strict";n.d(t,{Kv:function(){return r},R_:function(){return a}});let r={fromJSON:e=>({actorTraces:isObject(e.actorTraces)?Object.entries(e.actorTraces).reduce((e,t)=>{let[n,r]=t;return e[Number(n)]=String(r),e},{}):{},rpcTraces:isObject(e.rpcTraces)?Object.entries(e.rpcTraces).reduce((e,t)=>{let[n,r]=t;return e[n]=String(r),e},{}):{},compactionTaskTraces:isObject(e.compactionTaskTraces)?Object.entries(e.compactionTaskTraces).reduce((e,t)=>{let[n,r]=t;return e[n]=String(r),e},{}):{}}),toJSON(e){let t={};if(e.actorTraces){let n=Object.entries(e.actorTraces);n.length>0&&(t.actorTraces={},n.forEach(e=>{let[n,r]=e;t.actorTraces[n]=r}))}if(e.rpcTraces){let n=Object.entries(e.rpcTraces);n.length>0&&(t.rpcTraces={},n.forEach(e=>{let[n,r]=e;t.rpcTraces[n]=r}))}if(e.compactionTaskTraces){let n=Object.entries(e.compactionTaskTraces);n.length>0&&(t.compactionTaskTraces={},n.forEach(e=>{let[n,r]=e;t.compactionTaskTraces[n]=r}))}return t},create:e=>r.fromPartial(null!=e?e:{}),fromPartial(e){var t,n,r;let a={actorTraces:{},rpcTraces:{},compactionTaskTraces:{}};return a.actorTraces=Object.entries(null!==(t=e.actorTraces)&&void 0!==t?t:{}).reduce((e,t)=>{let[n,r]=t;return void 0!==r&&(e[Number(n)]=String(r)),e},{}),a.rpcTraces=Object.entries(null!==(n=e.rpcTraces)&&void 0!==n?n:{}).reduce((e,t)=>{let[n,r]=t;return void 0!==r&&(e[n]=String(r)),e},{}),a.compactionTaskTraces=Object.entries(null!==(r=e.compactionTaskTraces)&&void 0!==r?r:{}).reduce((e,t)=>{let[n,r]=t;return void 0!==r&&(e[n]=String(r)),e},{}),a}},a={fromJSON:e=>({dir:null!=e.dir?String(e.dir):"",nameManually:Array.isArray(null==e?void 0:e.nameManually)?e.nameManually.map(e=>String(e)):[],nameAuto:Array.isArray(null==e?void 0:e.nameAuto)?e.nameAuto.map(e=>String(e)):[]}),toJSON(e){var t,n;let r={};return""!==e.dir&&(r.dir=e.dir),(null===(t=e.nameManually)||void 0===t?void 0:t.length)&&(r.nameManually=e.nameManually),(null===(n=e.nameAuto)||void 0===n?void 0:n.length)&&(r.nameAuto=e.nameAuto),r},create:e=>a.fromPartial(null!=e?e:{}),fromPartial(e){var t,n,r;let a={dir:"",nameManually:[],nameAuto:[]};return a.dir=null!==(r=e.dir)&&void 0!==r?r:"",a.nameManually=(null===(t=e.nameManually)||void 0===t?void 0:t.map(e=>e))||[],a.nameAuto=(null===(n=e.nameAuto)||void 0===n?void 0:n.map(e=>e))||[],a}};function isObject(e){return"object"==typeof e&&null!==e}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:window}},function(e){e.O(0,[714,235,731,383,774,888,179],function(){return e(e.s=84808)}),_N_E=e.O()}]);